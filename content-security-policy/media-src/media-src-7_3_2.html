<!DOCTYPE HTML>
<html>
<head>
    <title>Video track src attribute must match src list - negative test</title>
    <script src='/resources/testharness.js'></script>
    <script src='/resources/testharnessreport.js'></script>
</head>
<body>
    <h1>Video track src attribute must match src list - negative test</h1>

    <script>
        'use strict';

        const source_test =
            async_test("Blocked <track> must fire 'onerror' and not 'onload' or 'onloadeddata'.");

        const trackURL = location.protocol +
            "//www." +
            location.hostname +
            ":" +
            location.port +
            "/media/foo.vtt";

        function media_loaded(t, eventName) {
            t.step(function() {
                assert_unreached(`Blocked <track> must not invoke '${eventName}' callback.`);
                t.done();
            });
        }

        function media_error_handler(t) {
            // Defer completing the test so that we have an opportunity to notice if the 'onload'
            // or 'onloadeddata' are also raised.
            requestAnimationFrame(() => {
                t.done();
            });
        }
    </script>

    <video id="videoObject" width="320" height="240" controls
           onerror="media_error_handler(source_test)"
           crossorigin>
        <source id="audioSourceObject"
                type="audio/mpeg"
                src="/media/white.mp4">
        <track default
               id="trackObject"
               kind="subtitles"
               srclang="en"
               label="English"
               onerror="media_error_handler(source_test)"
               onload="media_loaded(source_test, 'onload')"
               onloadeddata="media_loaded(source_test, 'onloadeddata')">
    </video>
    <script>
        document.getElementById("trackObject").src = trackURL;
    </script>

    <script async defer src="../support/checkReport.sub.js?reportField=violated-directive&reportValue=media-src%20%27self%27"></script>
</body>
</html>
